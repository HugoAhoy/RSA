#include "Int.hpp"
#include "string"
#include "gmock/gmock.h"
#include "gtest/gtest.h"
#include "util.hpp"

TEST(utilTest, RandomNbitInt){
    Int b31 = Int(1ll<<31);
    Int b32 = Int(1ll<<32);
    Int b63 = b31*b32;
    Int b64 = b32*b32;
    Int b127 = b64*b63;
    Int b128 = b64*b64;
    Int b255 = b128*b127;
    Int b256 = b128*b128;
    Int b511 = b256*b255;
    Int b512 = b256*b256;
    Int b767 = b512*b255;
    Int b768 = b512*b256;
    Int b1023 = b512*b511;
    Int b1024 = b512*b512;
    Int b2047 = b1024*b1023;
    Int b2048 = b1024*b1024;
    Int b4095 = b2048*b2047;
    Int b4096 = b2048*b2048;
    EXPECT_THAT(Random_Nbits_Int(64),::testing::AllOf(::testing::Lt(b64),::testing::Ge(b63)));
    EXPECT_THAT(Random_Nbits_Int(128),::testing::AllOf(::testing::Lt(b128),::testing::Ge(b127)));
    EXPECT_THAT(Random_Nbits_Int(256),::testing::AllOf(::testing::Lt(b256),::testing::Ge(b255)));
    EXPECT_THAT(Random_Nbits_Int(512),::testing::AllOf(::testing::Lt(b512),::testing::Ge(b511)));
    EXPECT_THAT(Random_Nbits_Int(768),::testing::AllOf(::testing::Lt(b768),::testing::Ge(b767)));
    EXPECT_THAT(Random_Nbits_Int(1024),::testing::AllOf(::testing::Lt(b1024),::testing::Ge(b1023)));
    EXPECT_THAT(Random_Nbits_Int(2048),::testing::AllOf(::testing::Lt(b2048),::testing::Ge(b2047)));
    EXPECT_THAT(Random_Nbits_Int(4096),::testing::AllOf(::testing::Lt(b4096),::testing::Ge(b4095)));
}

TEST(utilTest, MillerRabin){
  EXPECT_TRUE(Miller_Rabin(Int("204621874640810643337968405915083558979110125573625377330922675715231961180541")));
  EXPECT_TRUE(Miller_Rabin(Int("191898848773336837702150622791299248787583431392130539836314395837951935673423")));
  EXPECT_TRUE(Miller_Rabin(Int("206357011186104732359638149826065549604001277461215572043313500670299764468739")));
  EXPECT_TRUE(Miller_Rabin(Int("198532606578536809736124640275786770684391753481430589629620282062685286209231")));
  EXPECT_TRUE(Miller_Rabin(Int("187207183379110468530703239626027075171449533626333663701965444678389942390593")));

  EXPECT_FALSE(Miller_Rabin(Int("169184843662550574985939452698548865117531518847065333766020103593525130182217")));
  EXPECT_FALSE(Miller_Rabin(Int("161645506713608836429777001168264917673301997376043393305982068672793727971512")));
  EXPECT_FALSE(Miller_Rabin(Int("126923534819709776361629483892438576002415910428422590817953484108071034708141")));
  EXPECT_FALSE(Miller_Rabin(Int("183330558543077176778644935956624706879227149068188702581479244561902523203807")));
  EXPECT_FALSE(Miller_Rabin(Int("222709590724771495049253396590290866494314488981031713908663595903769397788071")));
}